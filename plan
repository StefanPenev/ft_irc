üõ†Ô∏è 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ (Server.cpp)

–í Server::setup() —Ä–µ–∞–ª–∏–∑—É–π:

    –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ–∫–µ—Ç–∞:

socket(AF_INET, SOCK_STREAM, 0);

–ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ—Ä—Ç—É:

    bind(...);

    –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SO_REUSEADDR –∏ fcntl() –Ω–∞ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º.

    –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ (listen()).

    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ–∫–µ—Ç–∞ –≤ —Å–ø–∏—Å–æ–∫ poll()-–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤.

üîÅ 3. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è poll()-—Ü–∏–∫–ª–∞ (PollManager)

–í PollManager::pollLoop():

    –í—ã–∑—ã–≤–∞–π poll() —Å —Ç–∞–π–º–∞—É—Ç–æ–º.

    –ï—Å–ª–∏ revents & POLLIN –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º —Å–æ–∫–µ—Ç–µ ‚Äî —ç—Ç–æ –Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç:

        –ü—Ä–∏–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (accept()).

        –£—Å—Ç–∞–Ω–æ–≤–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.

        –°–æ–∑–¥–∞–π Client –∏ –¥–æ–±–∞–≤—å –µ–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –≤ pollfds.

    –î–ª—è –∫–ª–∏–µ–Ω—Ç–∞:

        –ï—Å–ª–∏ POLLIN ‚Äî —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞.

        –ï—Å–ª–∏ POLLOUT ‚Äî –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.

        –ï—Å–ª–∏ POLLERR, POLLHUP ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞.

üßç 4. –ö–ª–∞—Å—Å Client

–•—Ä–∞–Ω–∏—Ç:

    –°–æ–∫–µ—Ç.

    –í—Ö–æ–¥—è—â–∏–π –∏ –∏—Å—Ö–æ–¥—è—â–∏–π –±—É—Ñ–µ—Ä (std::string).

    –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã.

    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é IRC-–∫–ª–∏–µ–Ω—Ç–∞: nickname, username, registered, –∏ —Ç.–¥.

–ú–µ—Ç–æ–¥—ã:

    readFromSocket()

    writeToSocket()

    hasCompleteCommand() ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –ø–æ–ª–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (–¥–æ \r\n).

    extractNextCommand() ‚Äî –≤—ã—Ä–µ–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –∏–∑ –±—É—Ñ–µ—Ä–∞.

üß† 5. –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥

–í –æ—Ç–¥–µ–ª—å–Ω–æ–º CommandParser –∏–ª–∏ –ø—Ä—è–º–æ –≤ Server:

    –†–∞–∑–¥–µ–ª—è–π –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –ø–æ \r\n.

    –ò—Å–ø–æ–ª—å–∑—É–π std::istringstream –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞:

        –ö–æ–º–∞–Ω–¥–∞.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã.

    –ü–æ –∏–º–µ–Ω–∏ –∫–æ–º–∞–Ω–¥—ã –≤—ã–∑—ã–≤–∞–π –Ω—É–∂–Ω—ã–π —Ö–µ–Ω–¥–ª–µ—Ä:

    if (cmd == "NICK") handleNick(client, args);
    else if (cmd == "JOIN") handleJoin(client, args);

üì° 6. –§–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π

–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PRIVMSG –∏–ª–∏ NOTICE:

    –ù–∞–π–¥–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–¥—Ä—É–≥–æ–π –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –∫–∞–Ω–∞–ª).

    –û—Ç–ø—Ä–∞–≤—å –µ–º—É —á–µ—Ä–µ–∑ –±—É—Ñ–µ—Ä send() (–≤ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–º —Ä–µ–∂–∏–º–µ ‚Äî —á–µ—Ä–µ–∑ POLL_OUT).

‚ùå 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π

    –ï—Å–ª–∏ recv() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 ‚Äî –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

    –ï—Å–ª–∏ recv() –∏–ª–∏ send() –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç -1 —Å –æ—à–∏–±–∫–æ–π ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞.

    –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –∫–æ–º–∞–Ω–¥–µ ‚Äî –æ—Ç–ø—Ä–∞–≤—å ERR_–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç—É.

    –£–¥–∞–ª—è–π –∫–ª–∏–µ–Ω—Ç–æ–≤ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ: –∑–∞–∫—Ä–æ–π —Å–æ–∫–µ—Ç, —É–¥–∞–ª–∏ –∏–∑ pollfds, –æ—Å–≤–æ–±–æ–¥–∏ —Ä–µ—Å—É—Ä—Å—ã.



    ‚úÖ –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –†–ê–ë–û–ß–ò–ô –°–ï–†–í–ï–† (v0.1)

–¶–µ–ª—å: —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:

    –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è,

    –ø—Ä–∏–Ω–∏–º–∞–µ—Ç TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤,

    —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ —Å–æ–∫–µ—Ç–∞ –∏ –≤—ã–≤–æ–¥–∏—Ç –µ–≥–æ –≤ –∫–æ–Ω—Å–æ–ª—å,

    –æ—Ç–≤–µ—á–∞–µ—Ç "pong\n" –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

üìå –ß—Ç–æ –Ω—É–∂–Ω–æ:

    main.cpp

    Server –∫–ª–∞—Å—Å —Å setupSocket() –∏ run()

    –†–∞–±–æ—Ç–∞ —Å poll()

    –û–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±—É—Ñ–µ—Ä

üîÅ –ü–æ–≤–µ–¥–µ–Ω–∏–µ:

    –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (—á–µ—Ä–µ–∑ telnet).

    –ü–∏—à–µ—Ç hello.

    –°–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∏—Ç Received: hello, –æ—Ç–≤–µ—á–∞–µ—Ç pong\n.

‚û°Ô∏è –≠—Ç–æ —É–∂–µ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å telnet 127.0.0.1 6667
üîº v0.2: –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤

–¶–µ–ª—å: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
–ò–∑–º–µ–Ω–µ–Ω–∏—è:

    –í pollfds –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∂–¥—ã–π accept()-–Ω—É—Ç—ã–π —Å–æ–∫–µ—Ç.

    –•—Ä–∞–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ std::map<int, std::string> (fd -> –±—É—Ñ–µ—Ä).

    –û—Ç–≤–µ—á–∞—Ç—å –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

üîº v0.3: –ö–ª–∞—Å—Å Client

–¶–µ–ª—å: –≤—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∫–ª–∏–µ–Ω—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å Client.
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Client:

    –•—Ä–∞–Ω–∏—Ç fd, recvBuffer, sendBuffer.

    –ú–µ—Ç–æ–¥—ã: readData(), hasCompleteCommand(), getNextCommand(), queueMessage().

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –∞ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É—é.
üîº v0.4: –ü–∞—Ä—Å–∏–Ω–≥ IRC-–∫–æ–º–∞–Ω–¥

–¶–µ–ª—å: –Ω–∞—É—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ø–∞—Ä—Å–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–µ IRC-–∫–æ–º–∞–Ω–¥—ã (NICK, PING, USER, PRIVMSG).
–ù—É–∂–Ω–æ:

    parseCommand() ‚Üí —Ä–∞–∑–±–∏–≤–∞–µ—Ç –ø–æ –ø—Ä–æ–±–µ–ª–∞–º.

    –¢–∞–±–ª–∏—Ü–∞ –∫–æ–º–∞–Ω–¥: std::map<std::string, HandlerFunc>.

üîº v0.5: –û—Ç–≤–µ—Ç –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É IRC

–¶–µ–ª—å: —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç IRC-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É.

–ù–∞–ø—Ä–∏–º–µ—Ä:

:localhost 001 nick :Welcome to the IRC server

üîº v0.6: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤

–¶–µ–ª—å: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JOIN, PRIVMSG #channel, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
üîº v0.7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

    –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

    –ö–ª–∏–µ–Ω—Ç –æ–±—è–∑–∞–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å PASS <pass> –¥–æ NICK/USER.

üîº v0.8 –∏ –¥–∞–ª–µ–µ:

    QUIT, PART, KICK, TOPIC –∏ —Ç.–¥.

    –ö–∞–Ω–∞–ª—ã —Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π.

    –õ–æ–≥–∏.

    –ú—É—Ç/–±–∞–Ω –∏ —Ç.–¥.

–•–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å —Å v0.1?

–Ø –º–æ–≥—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–±–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π main.cpp –∏ Server.hpp/cpp, –∫–æ—Ç–æ—Ä—ã–π:

    —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç,

    –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è,

    —á–∏—Ç–∞–µ—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç "pong\n".